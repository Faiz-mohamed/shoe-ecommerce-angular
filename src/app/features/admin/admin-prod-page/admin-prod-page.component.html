<section class="admin-products-page">
  <header class="ap-header">
    <div class="ap-title">
      <h1>Products</h1>
      <p class="muted">Manage your catalog â€” view, add, update, delete</p>
    </div>

    <div class="ap-actions">
      <div class="filter-row">
        <label class="sr-only" for="categoryFilter">Category</label>
        <select id="categoryFilter" #categoryFilter class="select" (change)="filterCategory(categoryFilter.value)">
          <option value="all">All categories</option>
          <option value="sneakers">Man</option>
          <option value="running">Women</option>
          <option value="casual">Sports</option>
        </select>

        <input #searchBox type="search" placeholder="Search products" class="input search" (input)="searchProducts(searchBox.value)" />
      </div>

      <button class="btn btn-primary" (click)="openAdd()">+ Add product</button>
    </div>
  </header>

  <main class="ap-main">
    <!-- Summary cards -->
    <div class="cards">
      <div class="card">
        <div class="card-title">Total</div>
        <div class="card-value">{{ totalProducts }}</div>
      </div>

      <div class="card">
        <div class="card-title">Categories</div>
        <div class="card-value">{{ totalCategories }}</div>
      </div>

      <div class="card">
        <div class="card-title">Low stock</div>
        <div class="card-value">{{ lowStockCount }}</div>
      </div>
    </div>

    <!-- Product table -->
    <div class="table-wrap">
      <table class="product-table" aria-label="Products">
        <thead>
          <tr>
            <th>Product</th>
            <th>Category</th>
            <th>Price</th>
            <th>Stock</th>
            <th class="col-actions">Actions</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let product of filteredProducts">
            <td class="cell-product">
              <img [src]="product.image" [alt]="product.name" class="thumb" />
              <div class="meta">
                <div class="name">{{ product.name }}</div>
                <div class="muted small">SKU: {{ product.sku }}</div>
              </div>
            </td>
            <td>{{ product.category }}</td>
            <td>â‚¹ {{ product.price | number }}</td>
            <td>
              <span class="stock" [ngClass]="{'in-stock': product.stock > 0, 'out-of-stock': product.stock === 0}">
                {{ product.stock }}
              </span>
            </td>
            <td class="col-actions">
              <button class="icon-btn" title="Edit" (click)="openEdit(product)">âœŽ</button>
              <button class="icon-btn danger" title="Delete" (click)="promptDelete(product)">ðŸ—‘</button>
            </td>
          </tr>

          <tr *ngIf="filteredProducts.length === 0">
            <td colspan="5" class="muted" style="text-align:center; padding:18px;">No products found.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>

  <!-- Add / Edit Modal -->
  <div class="modal" *ngIf="modalOpen">
    <div class="modal-backdrop" (click)="closeModal()"></div>
    <div class="modal-panel-wrapper">
      <form class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="modalTitle" (ngSubmit)="saveProduct()">
        <header class="modal-header">
          <h2 id="modalTitle">{{ isEditMode ? 'Edit product' : 'Add product' }}</h2>
          <button type="button" class="close" (click)="closeModal()">âœ•</button>
        </header>

        <div class="modal-body">
          <div class="form-grid">
            <label>
              <span class="label">Name</span>
              <input name="name" required class="input" placeholder="Product name" [(ngModel)]="selectedProduct.name" />
            </label>

            <label>
              <span class="label">Category</span>
              <select name="category" class="select" required [(ngModel)]="selectedProduct.category">
                <option value="">Select</option>
                <option value="sneakers">Sneakers</option>
                <option value="running">Running</option>
                <option value="casual">Casual</option>
              </select>
            </label>

            <label>
              <span class="label">Price (â‚¹)</span>
              <input name="price" type="number" min="0" class="input" required [(ngModel)]="selectedProduct.price" />
            </label>

            <label>
              <span class="label">Stock</span>
              <input name="stock" type="number" min="0" class="input" required [(ngModel)]="selectedProduct.stock" />
            </label>

            <label class="full">
              <span class="label">Image URL</span>
              <input name="image" class="input" placeholder="https://example.com/image.jpg" [(ngModel)]="selectedProduct.image" />
            </label>

            <label class="full">
              <span class="label">Description</span>
              <textarea name="description" rows="3" class="textarea" placeholder="Short product description" [(ngModel)]="selectedProduct.description"></textarea>
            </label>
          </div>
        </div>

        <footer class="modal-footer">
          <button type="button" class="btn btn-muted" (click)="closeModal()">Cancel</button>
          <button type="submit" class="btn btn-primary">Save product</button>
        </footer>
      </form>
    </div>
  </div>

  <!-- Delete Modal -->
  <div class="modal" *ngIf="deleteTarget">
    <div class="modal-backdrop" (click)="cancelDelete()"></div>
    <div class="modal-panel-wrapper">
      <div class="modal-panel small" role="dialog" aria-modal="true">
        <header class="modal-header">
          <h3>Confirm delete</h3>
          <button type="button" class="close" (click)="cancelDelete()">âœ•</button>
        </header>
        <div class="modal-body">
          <p>Are you sure you want to delete <strong>{{ deleteTarget?.name }}</strong>?</p>
        </div>
        <footer class="modal-footer">
          <button class="btn btn-muted" (click)="cancelDelete()">Cancel</button>
          <button class="btn danger" (click)="confirmDelete()">Delete</button>
        </footer>
      </div>
    </div>
  </div>
</section>
